<?php

namespace Dime\TimetrackerBundle\Entity;

use Dime\TimetrackerBundle\Entity\EntityRepository;
use Doctrine\ORM\QueryBuilder;
/**
 * ActivityRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ActivityRepository extends EntityRepository
{
    public function scopeByDate($date, QueryBuilder $qb = null, $alias = 'a')
    {
        if ($qb == null) {
            $qb = $this->createQueryBuilder($alias);
        } else {
            $alias = $qb->getRootAliases();
            $alias = array_shift($alias);
        }

        if (is_array($date)) {
            $qb->andWhere($qb->expr()->between($alias . '.updatedAt', ':from', ':to'));
            $qb->setParameter(':from', $date[0]);
            $qb->setParameter(':to', $date[1]);
        } else {
            $qb->andWhere($qb->expr()->like($alias . '.updatedAt', ':date'));
            $qb->setParameter('date', $date . '%');
        }

        return $qb;
    }

    public function scopeByCustomer($id, QueryBuilder $qb = null, $alias = 'a')
    {
        if ($qb == null) {
            $qb = $this->createQueryBuilder($alias);
        } else {
            $alias = $qb->getRootAliases();
            $alias = array_shift($alias);
        }

        $qb->andWhere($alias . '.customer = :customer');
        $qb->setParameter('customer', $id);

        return $qb;
    }
}
